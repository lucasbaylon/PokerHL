<ion-button class="backArrow" (click)="redirectTo('situations-list-manager')">
    <ion-icon name="arrow-back-outline"></ion-icon>
</ion-button>
@if (mode === 'new') {
    <h1>Enregistrer une nouvelle situation</h1>
}
@if (mode === 'edit') {
    <h1>Modifier la situation</h1>
}
<div class="div-input-text field">
    <input [(ngModel)]="situation_obj.name" type="text" class="styled-input-text" placeholder="Nom de la situation"
        name="situationName" id='situationName' autocomplete="off" />
    <label for="situationName" class="styled-input-text-label">Nom de la situation</label>
</div>
<!-- <div class="case-definition animate__animated animate__fadeIn"> -->
<div class="case-definition">
    <table (mouseleave)="endSelection($event)" oncontextmenu="return false;">
        <tbody>
            @for (row of situation_obj.situations; track i; let i = $index) {
                <tr class="table-row animate__animated animate__fadeIn" [style.animation-delay]="i * 0.05+'s'">
                    @for (item of row; track j; let j = $index) {
                        <td (mousedown)="startSelection($event)" (mouseenter)="updateSelection($event)" (mouseup)="endSelection($event)" [ngStyle]="{'background': (item.action! | actionColor:situation_objActionsRef), 'color': item.action ? 'white' : '#303030'}">
                            {{item.card}}
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
    <div class="solutions">
        <h2>Solutions</h2>
        @for (action of filteredActionList(situation_obj.actions, 'unique'); track i; let i = $index) {
            <div class="solution-selector">
                <input type="input" class="textInput" value="{{action.display_name}}" [id]="'input_' + action.id"
                    (input)="onChangeActionName(action.id, $event)" placeholder="-" autocomplete="off" />
                <div class="color-picker-square"
                    [ngStyle]="{'background': commonService.cellBackground(action, situation_objActionsRef)}"
                    (click)="onColorAction(action.id)"></div>
                <label>
                    <input type="radio" name="radio_button" [id]="'radio_' + action.id" [value]="action.id"
                        (click)="onChangeAction($event)" [checked]="i === 0 ? true : false">
                    <span class="design"></span>
                </label>
            </div>
            <div class="color-picker-div color-picker-div-closed animate__animated animate__zoomIn"
                [id]="'color-picker-div_' + action.id">
                <div class="colors">
                    <div class="color-picker-square" style="background: #d80c05"
                        (click)="onSelectColor(action.id, '#d80c05')"></div>
                    <div class="color-picker-square" style="background: #ff9100"
                        (click)="onSelectColor(action.id, '#ff9100')"></div>
                    <div class="color-picker-square" style="background: #7a5a00"
                        (click)="onSelectColor(action.id, '#7a5a00')"></div>
                    <div class="color-picker-square" style="background: #3f7a89"
                        (click)="onSelectColor(action.id, '#3f7a89')"></div>
                    <div class="color-picker-square" style="background: #96c582"
                        (click)="onSelectColor(action.id, '#96c582')"></div>
                    <div class="color-picker-square" style="background: #303030"
                        (click)="onSelectColor(action.id, '#303030')"></div>
                    <div class="color-picker-square" style="background: #1c51ff"
                        (click)="onSelectColor(action.id, '#1c51ff')"></div>
                    <div class="color-picker-square" style="background: #00aeff"
                        (click)="onSelectColor(action.id, '#00aeff')"></div>
                    <div class="color-picker-square" style="background: #8400ff"
                        (click)="onSelectColor(action.id, '#8400ff')"></div>
                    <div class="color-picker-square" style="background: #e284ff"
                        (click)="onSelectColor(action.id, '#e284ff')"></div>
                </div>
            </div>
        }
        <button class="fill addButton" id="add-solution-button" (click)="addUniqueAction()">Ajouter +</button>
    </div>
    <div class="multiples-solutions-div">
        <h2>Solutions multiples</h2>
        <div class="multiples-solutions-container">
            @for (action of filteredActionList(situation_obj.actions, 'mixed'); track $index) {
                <div class="multiples-solutions">
                    <div class="multiples-solutions-name">
                        {{action.display_name}}
                    </div>
                    <div class="color-picker-square"
                        [ngStyle]="{'background': commonService.cellBackground(action, situation_objActionsRef)}"></div>
                    <label>
                        <input type="radio" name="radio_button" [id]="'radio_' + action.id" [value]="action.id"
                            (click)="onChangeAction($event)">
                        <span class="design"></span>
                    </label>
                    <ion-button (click)="editMultipleSolution(action.id)">
                        <ion-icon name="pencil-outline"></ion-icon>
                    </ion-button>
                    <ion-button (click)="deleteMultipleSolution(action.id)">
                        <ion-icon name="trash-outline"></ion-icon>
                    </ion-button>
                </div>
            }
        </div>
        <button class="fill addButton" (click)="showAddMultiplesAction()">Ajouter +</button>
    </div>
    <div class="add-multiples-solutions-container">
        <div class="add-multiples-solutions animate__animated animate__fadeInDown" id="add-multiples-solutions">
            <ion-button (click)="resetMultipleSituation()">
                <ion-icon name="close-outline"></ion-icon>
            </ion-button>
            <h2 class="add-multiples-solutions-h2">Ajout d'une solution multiple</h2>
            <div class="div-input-text field input-name-multiples-solutions">
                <input [(ngModel)]="multipleSolutionName" type="text" class="styled-input-text" placeholder="Nom"
                    name="multipleSolution" id='multipleSolution' autocomplete="off" />
                <label for="multipleSolution" class="styled-input-text-label">Nom de la multiplicité</label>
            </div>
            @for (action of filteredActionList(situation_obj.actions, 'unique'); track i; let i = $index) {
                <div class="solution-selector">{{action.display_name}}<div class="color-picker-square"
                        [style]="'background: ' + action.color"></div>
                    <input type="checkbox" class="cbx" [id]="'id_check_'+ action.id" (change)="onCheckChange($event)">
                    <label [for]="'id_check_'+ action.id" class="check">
                        <svg width="18px" height="18px" viewBox="0 0 18 18">
                            <path
                                d="M1,9 L1,3.5 C1,2 2,1 3.5,1 L14.5,1 C16,1 17,2 17,3.5 L17,14.5 C17,16 16,17 14.5,17 L3.5,17 C2,17 1,16 1,14.5 L1,9 Z">
                            </path>
                            <polyline points="1 9 7 14 15 4"></polyline>
                        </svg>
                    </label>
                </div>
            }
            @if (simpleSlider) {
                <div class="custom-slider">
                    <ngx-slider [(value)]="mixedSolutionSliderMinValue" [options]="options"></ngx-slider>
                </div>
            }
            @if (multipleSlider) {
                <div class="custom-slider">
                    <ngx-slider [(value)]="mixedSolutionSliderMinValue" [(highValue)]="mixedSolutionSliderMaxValue"
                        [options]="options"></ngx-slider>
                </div>
            }
            <button class="fill addButton" id="add-multiple-solution-button"
                (click)="addMultipleAction()">Enregistrer</button>
        </div>
    </div>
</div>
<div class="situation-caracteristics">
    <h2>Caractéristiques de la situation</h2>
    <div class="caracteristic-container">
        <div class="caracteristic-description">Nombre de BB minimum sur la table</div>
        <p-inputNumber inputId="integeronly" [size]="10" [min]="0" [(ngModel)]="situation_obj.dealerMissingTokens"></p-inputNumber>
    </div>
    <div class="caracteristic-container">
        <div class="caracteristic-description">Nombre de joueurs sur la table</div>
        <p-dropdown [(ngModel)]="nbPlayer" [options]="availableNbPlayersTable" (onChange)="onChangeNbPlayersTable()"
            optionLabel="name"></p-dropdown>
    </div>
    <div class="caracteristic-container">
        <div class="caracteristic-description">Joueur bouton</div>
        <p-dropdown [(ngModel)]="dealer" [options]="availableDealerPlayer" (onChange)="onChangeDealer()"
            optionLabel="name"></p-dropdown>
    </div>
    <div class="caracteristic-container">
        <div class="caracteristic-description">Niveau des adversaires</div>
        <p-dropdown [(ngModel)]="opponentLevel" [options]="availableOpponentsPlayersLevel"
            (onChange)="onChangeOpponentLevel()" optionLabel="name"></p-dropdown>
    </div>
</div>
<button class="fill saveButton animate__animated animate__fadeInUp" (click)="saveSituation()">Enregistrer</button>